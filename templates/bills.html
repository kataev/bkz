{% extends 'main.html' %}
{% block title %}Накладные{% endblock %}
{% block media %}
    {{ form.media }}
    <link rel='stylesheet' href="{{ DOJANGO.DOJOX_URL }}/grid/resources/Grid.css" type="text/css">
    <link rel='stylesheet' href="{{ DOJANGO.DOJOX_URL }}/grid/resources/{{ DOJANGO.THEME }}Grid.css" type="text/css">
    <script type="text/javascript">
        dojo.addOnLoad(function() {
            dijit.byId('id_date__lte').onChange = function() {
                dijit.byId('id_date__gte').constraints.min = arguments[0];
            };
            dijit.byId('id_date__gte').onChange = function() {
                dijit.byId('id_date__lte').constraints.max = arguments[0];
            };
            dijit.byId('form').onSubmit = function(e) {
                dojo.stopEvent(e);
                query={}
                var val = this.get('value');
                for (var a in val) {
                    if (!val[a]) dojo.query('[name=' + a + ']', this.containerNode).attr('disabled', 'disabled');
                    else {
                        console.log(val[a])
                        if (a=='date__lte' || a=='date__gte') query[a]=dojo.date.stamp.toISOString(val[a]).split('T')[0]
                        else query[a]=val[a]
                    }
                }
                console.log(query);
                BillStore.url = './store/?'+dojo.objectToQuery(query);
                BillStore.close();
                dijit.byId('BillsTable').render();
            };
        });
    </script>
{% endblock %}
{% block pane %}
    <div dojoType="dojo.data.ItemFileReadStore" jsId="BillStore"
         clearOnClose='true' url="store/?{{ path }}"></div>
    <table dojoType="dojox.grid.DataGrid" region='center' id="BillsTable" store='BillStore'>
{% endblock %}
{% block content %}

    <thead>
    <tr>
        <th field="number" formatter="Formatter">#</th>
        <th field="date" width="120px" formatter="date_formatter">Дата</th>
        <th field="agent" width="200px" formatter="Formatter">Контрагент</th>
        <th field="money" aggregate='sum'>Деньги</th>
        <th field="info" width='auto'>Информация</th>

    </tr>
    </thead>
    </table>
    </div>
    <div dojoType="dijit.layout.ContentPane" region='top'>
        <form method="GET" dojoType='dijit.form.Form' id='form' action="./">
            {{ form.brick }}
            {{ form.date__gte }}
            {{ form.date__lte }}
            {{ form.agent }}
            <button dojoType='dijit.form.Button' type=submit>Показать</button>
        </form>
{% endblock %}