{% extends 'main.html' %}
{% block title %}Накладные{% endblock %}
{% block media %}
    <style>
        article {
            clear: left;
            border: 1px black solid;
        }
        #id_date__lte,#id_date__gte {
            width:20px;
        }
        div.date {
            /*position: relative;*/
            left: 2px;
            top: 2px;
            width: 50px;
            float: left;
            border: 2px red solid;
            text-align: center;
        }

        .table {
            border: 1px black solid;
        }
    </style>
    <script type="text/javascript">
    dojo.require('dijit.form.Form');
        dojo.addOnLoad(function() {
//            dijit.byId('id_date__lte').onChange=function(){dijit.byId('id_date__gte').constraints.min = arguments[0];}
//            dijit.byId('id_date__gte').onChange=function(){dijit.byId('id_date__lte').constraints.max = arguments[0];}

            dijit.byId('form').onSubmit = function(e) {
//        dojo.stopEvent(e);
                var val = this.get('value');
                console.log(this)
                for (a in val) {
                    if (!val[a]) {
                        console.log(a);
                        dojo.query('[name=' + a + ']', this.containerNode).attr('disabled', 'disabled');
                    }
                }
            }
        });
    </script>
{% endblock %}
{% block content %}
    <table style='display: none;'>
        {% for b in bills %}
            {% ifchanged b.date %}</table>
                <table class='bills_table bills'>
                <caption>{{ b.str_date }}</caption>{% endifchanged %}
            <tr pk='{{ b.pk }}'>
                <td>{{ b.number }}</td>
                <td>{{ b.agent.cool_name|truncatewords:2 }}</td>
                <td>{{ b.money }}</td>
            </tr>
            {% for s in b.sold.all %}
                <tr class='oper sold' pk='{{ s.pk }}'>
                    <td></td>
                    <td>{{ s.brick }}</td>
                    <td>{{ s.amount }}</td>
                    <td>{{ s.price }}</td>
                    <td>{{ s.delivery }}</td>
                </tr>
                {% for t in s.bill_transfer_related.all %}
                    <tr class='oper transfer' pk='{{ t.pk }}'>
                    <td></td>
                    <td>{{ s.brick }}</td>
                    <td>{{ s.amount }}</td>
                </tr>
                    {% endfor %}
            {% endfor %}
            {#        {% ifchanged b.date %}{% endifchanged %}#}
        {% endfor %}
        </table>
    </div>
    <div dojoType="dijit.layout.ContentPane" region='top'>
        <form method="GET" dojoType='dijit.form.Form' id='form' action="./">
            {{ form.brick }}
            {{ form.date__lte }}
            {{ form.date__gte }}
            {{ form.agent }}
            <button dojoType='dijit.form.Button' type=submit>Показать</button>
        </form>
{% endblock %}