{% extends 'index.html' %}
{% load class_name %}
{% block brick-select %}
    <div id="brick-select" class="modal hide fade">
        <div class="modal-header">
            <a class="close" data-dismiss="modal">×</a>

            <h3>Выбор кирпича</h3>
        </div>
        <div class="modal-body">
            {% include 'brick-select.html' %}
        </div>
        <div class="modal-footer">
            <a href="#" class="brick-select btn btn-primary" data-dismiss="modal">Сохранить</a>
            <a href="#" class="btn" data-dismiss="modal">Закрыть</a>
        </div>
    </div>
{% endblock %}

{% block container %}
    <div class='hidden'>
        {% for factory in opers %}
            {% with form=factory.empty_form %}
                <div class="tab-pane" id="{{ form.prefix }}">
                    {% include 'fieldset.html' %}
                </div>
            {% endwith %}
        {% endfor %}
    </div>


    {#  Див для всплывающего окна Modal, работает из контекст процессора  #}
    <form method="POST" action="./" class='form-horizontal'>
        {% for factory in opers %}
            {{ factory.management_form }}
        {% endfor %}
        {#  Навигация  #}
        <div class="tabbable ">
            <ul class="nav nav-tabs">
                {#  Документ  #}
                <li class="active">
                    {% with form=doc %}
                        <a href="#{{ form.prefix }}" data-toggle="tab">
                            <span class="label {% if form.errors %}label-important{% endif %}">
                            {% if form.errors %}<i class="icon-warning-sign"></i>{% endif %}
                            <i class="icon-{{ form.instance|to_class_name }}"></i>
                                {{ form.instance|truncatewords:10 }}</span>
                        </a>
                    {% endwith %}
                </li>
                {#  Операции  #}
                {% for factory in opers %}
                    {% for form in factory %}
                            <li class="{{ form.Meta.name }}">
                                <a class='' href="#{{ form.prefix }}" data-toggle="tab">
                                    {% if form.errors %}<i class="icon-warning-sign"></i>{% endif %}
                                    <span class="label {% if form.errors %}label-important{% endif %}">
                                        {{ form.instance }}</span>
                                </a>
                            </li>
                    {% endfor %}
                {% endfor %}

                {#  Добавления  #}
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <i class='icon-plus'></i> Добавить<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                        {% for factory in opers %}
                            <li><a class='form-add' href="#{{ factory.prefix }}"><i class="icon-{{ factory.model|to_class_name }}"></i> {{ factory.model }} </a></li>
                        {% endfor %}
                    </ul>
                </li>
            </ul>

            <div class="tab-content">
                {#  Форма документа  #}
                {% with form=doc %}
                    <div class="tab-pane active" id="{{ form.prefix }}">
                        {% include 'fieldset.html' %}
                    </div>
                {% endwith %}
                {#  Формы операций  #}
                {% for factory in opers %}
                    {% for form in factory %}
                        <div class="tab-pane" id="{{ form.prefix }}">
                            {% include 'fieldset.html' %}
                        </div>
                    {% endfor %}
                {% endfor %}
            </div>
        </div>
        <div class="form-actions">
            <button type="submit" class="btn btn-primary"><i class="icon-ok icon-white"></i> Сохранить изменения
            </button>
            <button type="reset" class="btn"><i class="icon-ban-circle"></i> Отменить</button>
        </div>
    </form>
<div>

</div>

{% endblock %}