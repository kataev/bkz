{% extends 'core/index.html' %}
{% load bkz %}
{% block title %}Садка за {{ date|date:'j E Y, l' }}{% endblock %}
{% block script %}
    <script type="text/javascript" src="/static/js/libs/jquery-ui-1.10.0.custom.min.js"></script>
{% endblock %}
{% block container %}
<div class="container" id='warren'>
    <div class="row">
            <div class="span7">
                <h1 class='datehead'>
                    <a href='?date={{ dateform.previous.isoformat }}'><i class='icon-arrow-left'></i></a>
                    Садка <small>за {{ date|date:'j E Y, l' }}</small>
                    <a href='?date={{ dateform.next.isoformat }}'><i class='icon-arrow-right'></i></a>
                </h1>
            </div>
            <form accept-chartset='utf-8' method="GET" action="" class="form-inline span5" style='margin-top: 10px;text-align:right'>
                {{ dateform.date }}
                <input type="submit" class="btn">
            </form>
    </div>
    <form accept-chartset='utf-8' method="POST" id='form' class='row less'>
        {% csrf_token %}
        {{ factory.management_object }}
        {{ factory.management_form }}
        {% for form in factory %}
        <fieldset class='span3'>
        <table>
            <thead>
                <tr>
                    <th>№ ТТО</th>
                    <th>ТТС</th>
                    <th colspan="2">% брака</th>
                </tr>
            </thead>
        <tbody>
            <tr>
                <th>{{ form.number }}
                    {% for field in form.hidden_fields %} {{ field }} {% endfor %}
                    {{ form.tts.management_object }}
                    {{ form.tts.management_form }}
                    {{ form.errors }}
                </th>
                {% for f in form.tts %}
                    {% if not forloop.first %}
                        <tr><th class="input-prepend">
                            {{ f.errors }}
                            <span class='add-on' style='float:right'>
                                <a  tabindex='-1' href='{{ form.instance.get_absolute_url }}'>{{ f.order.value }}</a>
                            </span>
                        </th>
                    {% endif %}
                    {% for field in f.visible_fields %}
                    {% if field.name == 'cause' %}
                        <td class="input-append dropdown counter">
                            {% if forloop.first %}{% for field in form.hidden_fields %} {{ field }} {% endfor %}{% endif %}
                            <ul class="dropdown-menu" role='menu'>
                            {{ field|removetags:'ul' }}
                            </ul>
                            <a href="#{{ field.html_name }}" class="dropdown-toggle add-on" role='button' data-toggle="dropdown">
                                <span class='label {% if field.value|length %}label-warning{% endif %}'>
                                    {{ field.value|length }}
                                </span> <b class="caret"></b>
                            </a>
                            
                        </td>
                    {% else %}
                        <td>
                            {% if forloop.first %}{% for field in f.hidden_fields %} {{ field }} {% endfor %}{% endif %}
                            {{ field }}
                        </td>
                    {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
        </tbody>
        <tfoot>
            <tr> <th colspan="2" style="text-align:right"> Остаток </th>
                 <td colspan="2"> {{ form.brocken }} </td> 
            </tr>
        </tfoot>
        </table>
        </fieldset>
        {% endfor %}    
    </form>
    <div class='alert alert-info'>
        Для удобного переключения между полями используйте кнопку Tab
    </div>
</div>
<div class="form-actions">
        <div class="container">
            <button type="submit" class="btn btn-primary" form="form">
                <i class="icon-ok icon-white"></i> Сохранить изменения
            </button>
        </div>
    </div>
{% endblock %}